<div class="form-editor-container container-fluid vh-100 d-flex flex-column p-3">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <div class="d-flex align-items-center gap-3">
      <button class="btn btn-outline-secondary" (click)="goBack()">â† Retour</button>
      <h3 class="mb-0">{{ isEditMode ? 'Modifier' : 'CrÃ©er' }} un formulaire</h3>
    </div>

    <div class="d-flex flex-wrap gap-2">
      <button class="btn btn-outline-primary" (click)="togglePreview()" [disabled]="saving"
              title="Basculer entre Ã©dition et aperÃ§u">
        {{ showPreview ? 'âœï¸ Ã‰diter' : 'ğŸ‘ï¸ AperÃ§u' }}
      </button>
      <button class="btn btn-secondary" (click)="saveDraft()" [disabled]="saving"
              title="Enregistrer le formulaire en brouillon">
        {{ saving ? 'Enregistrement...' : 'ğŸ’¾ Enregistrer' }}
      </button>
      <button class="btn btn-success" (click)="saveAndPublish()" [disabled]="saving"
              title="Publier le formulaire">
        âœ… Publier
      </button>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="loading" class="position-relative text-center flex-grow-1 d-flex flex-column justify-content-center align-items-center">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-3 fw-semibold">Chargement...</p>
  </div>

  <!-- Editor + Sidebar -->
  <div *ngIf="!loading && !showPreview" class="d-flex flex-grow-1 gap-3 overflow-hidden">

    <!-- Sidebar -->
    <div class="sidebar bg-light border rounded p-3 flex-shrink-0" style="width: 220px; overflow-y: auto;">
      <h5>ğŸ’¡ Types de questions</h5>
      <p class="text-muted small mb-2">Cliquez pour insÃ©rer un template</p>

      <div class="d-grid gap-2 mb-4">
        <button class="btn btn-outline-primary btn-sm" (click)="insertTemplate('text')">ğŸ“ Texte court</button>
        <button class="btn btn-outline-primary btn-sm" (click)="insertTemplate('comment')">ğŸ“„ Texte long</button>
        <button class="btn btn-outline-primary btn-sm" (click)="insertTemplate('dropdown')">ğŸ“‹ Liste dÃ©roulante</button>
        <button class="btn btn-outline-primary btn-sm" (click)="insertTemplate('checkbox')">â˜‘ï¸ Cases Ã  cocher</button>
        <button class="btn btn-outline-primary btn-sm" (click)="insertTemplate('radiogroup')">ğŸ”˜ Choix unique</button>
        <button class="btn btn-outline-primary btn-sm" (click)="insertTemplate('rating')">â­ Notation</button>
        <button class="btn btn-outline-primary btn-sm" (click)="insertTemplate('boolean')">âœ”ï¸ Oui/Non</button>
        <button class="btn btn-outline-primary btn-sm" (click)="insertTemplate('file')">ğŸ“ Fichier</button>
      </div>

      <div class="help-section mt-auto">
        <h6>ğŸ“š Documentation</h6>
        <a href="https://surveyjs.io/form-library/documentation/api-reference/survey-data-model" target="_blank">
          Lien SurveyJS API
        </a>
      </div>
    </div>

    <!-- Editor -->
    <div class="editor flex-grow-1 d-flex flex-column h-100 overflow-hidden">
      <div class="card shadow-sm h-100 d-flex flex-column p-3 overflow-hidden">

        <div class="mb-2">
          <h5>Ã‰diteur JSON</h5>
          <p class="text-muted small mb-1">Modifiez le JSON pour crÃ©er votre formulaire</p>
        </div>

        <div *ngIf="jsonError" class="alert alert-danger py-2 mb-2">
          âš ï¸ {{ jsonError }}
        </div>

        <textarea
          id="jsonEditor"
          [(ngModel)]="jsonSchema"
          (ngModelChange)="validateJSON()"
          class="form-control flex-grow-1 mb-2"
          spellcheck="false"
          style="resize: none; overflow-y: auto;"
        ></textarea>

        <small class="text-muted">
          ğŸ’¡ Astuce : Utilisez les boutons Ã  gauche pour insÃ©rer des templates de questions.
        </small>
      </div>
    </div>

  </div>

  <!-- Preview Mode -->
  <div *ngIf="!loading && showPreview" class="card shadow-sm p-3 flex-grow-1 overflow-auto">
    <div class="mb-3">
      <h5>AperÃ§u du formulaire</h5>
      <p class="text-muted small">Voici comment les utilisateurs verront votre formulaire</p>
    </div>
    <div *ngIf="previewSurvey" class="overflow-auto">
      <survey [model]="previewSurvey"></survey>
    </div>
  </div>

</div>
